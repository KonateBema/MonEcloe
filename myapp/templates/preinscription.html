{% extends 'base.html' %}
{% load static %}

{% block title %}
Préinscription - {{ home_data.site_name }}
{% endblock %}

{% block content %}

<style>
  .header {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 30px;
  }

  .header img {
    max-height: 80px;
    margin-right: 15px;
  }

  .header h1 {
    font-size: 1.8rem;
    font-weight: 700;
    color: #333;
  }

  .card-form {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 30px;
    margin-bottom: 40px;
  }

  .btn-primary, .btn-success, .btn-secondary {
    border-radius: 8px;
    padding: 10px 20px;
    font-weight: 600;
  }

  .back-home {
    margin-bottom: 20px;
    text-align: center;
  }

  .alert-success {
    margin-top: 20px;
    display: none;
  }
</style>

<div class="container py-5">

  <!-- Header -->
  <div class="header">
    <img src="{% static 'images/logo.png' %}" alt="Logo">
    <h1>Préinscription en ligne - {{ home_data.site_name }}</h1>
  </div>

  <!-- Retour -->
  <div class="back-home">
    <a href="{% url 'home' %}" class="btn btn-secondary">← Retour à l’accueil</a>
  </div>

  <!-- Message succès -->
  <div id="successAlert" class="alert alert-success">
    ✅ Votre demande a été envoyée avec succès !
  </div>

  <!-- Formulaire -->
  <div class="card card-form">
    <form id="preinscriptionForm" method="POST" onsubmit="showRecapModal(event)">
      {% csrf_token %}

      <div class="row g-3 mb-3">
        <div class="col-md-6">{{ form.nom.label_tag }}{{ form.nom }}</div>
        <div class="col-md-6">{{ form.prenom.label_tag }}{{ form.prenom }}</div>
      </div>

      <div class="row g-3 mb-3">
        <div class="col-md-6">{{ form.email.label_tag }}{{ form.email }}</div>
        <div class="col-md-6">{{ form.telephone.label_tag }}{{ form.telephone }}</div>
      </div>

      <div class="row g-3 mb-3">
        <div class="col-md-6">{{ form.date_naissance.label_tag }}{{ form.date_naissance }}</div>
        <div class="col-md-6">{{ form.formation.label_tag }}{{ form.formation }}</div>
      </div>

      <div class="mb-3">
        {{ form.message.label_tag }}{{ form.message }}
      </div>

      <div class="text-center">
        <button type="submit" class="btn btn-primary">
          Voir le récapitulatif
        </button>
      </div>
    </form>
  </div>

</div>

<!-- MODAL -->
<div class="modal fade" id="recapModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Récapitulatif Préinscription</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body" id="recapContent">
        <p><strong>Nom :</strong> <span id="recapNom"></span></p>
        <p><strong>Prénom :</strong> <span id="recapPrenom"></span></p>
        <p><strong>Email :</strong> <span id="recapEmail"></span></p>
        <p><strong>Téléphone :</strong> <span id="recapTelephone"></span></p>
        <p><strong>Date de naissance :</strong> <span id="recapDateNaissance"></span></p>
        <p><strong>Formation :</strong> <span id="recapFormation"></span></p>
        <p><strong>Message :</strong> <span id="recapMessage"></span></p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-success" onclick="envoyerFormulaire()">
          ✅ Confirmer l’envoi
        </button>

        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Fermer
        </button>
      </div>

    </div>
  </div>
</div>

<!-- JS -->
<script>
function showRecapModal(event) {
  event.preventDefault();

  document.getElementById("recapNom").textContent =
    document.getElementById("id_nom").value;

  document.getElementById("recapPrenom").textContent =
    document.getElementById("id_prenom").value;

  document.getElementById("recapEmail").textContent =
    document.getElementById("id_email").value;

  document.getElementById("recapTelephone").textContent =
    document.getElementById("id_telephone").value;

  document.getElementById("recapDateNaissance").textContent =
    document.getElementById("id_date_naissance").value;

  document.getElementById("recapFormation").textContent =
    document.getElementById("id_formation").value;

  document.getElementById("recapMessage").textContent =
    document.getElementById("id_message").value;

  new bootstrap.Modal(document.getElementById('recapModal')).show();
}

function envoyerFormulaire() {
  document.getElementById("preinscriptionForm").submit();
}
</script>

{% endblock %}
