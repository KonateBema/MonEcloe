{% extends "admin/base_site.html" %}

{% block extrahead %}
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        background-color: #12141c;
        color: #fff;
        font-family: "Segoe UI", sans-serif;
        margin:0;
        padding:0;
    }

    /* Sidebar */
    .sidebar {
        position: fixed;
        top: 60px;
        left: 0;
        width: 220px;
        height: calc(100% - 60px);
        background-color: #1f222e;
        padding-top: 25px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        box-shadow: 2px 0 8px rgba(0,0,0,0.6);
        z-index: 100;
    }
    .sidebar a {
        color: #00c0ef;
        text-decoration: none;
        padding: 10px 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    .sidebar a:hover { background-color: #bcc0d1; transform: translateX(5px); }

    /* Main content */
    .main-content {
        width: 100%;
        max-width: 100%;
        padding: 20px;
        margin-left: 230px; /* pour Ã©viter le sidebar */
        color: #dae5e6;
    }

    /* Stat cards */
    .cards-wrapper { display: flex; flex-wrap: wrap; gap: 15px; }
    .stat-card {
        display: flex;
        align-items: center;
        background: linear-gradient(135deg, #d10da3, #d10da3);
        padding: 20px;
        border-radius: 15px;
        gap: 15px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.4);
        flex: 1 1 250px;
    }
    .stat-card i { font-size: 42px; color: #00c0ef; }

    /* Dashboard layout */
    .dashboard-row { display: flex; flex-direction: column; gap: 25px; margin-top: 30px; }
    .dashboard-col { width: 100%; }

    /* Chart card */
    .chart-card {
        background-color: #1f222e;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.4);
    }
    .chart-card h3 { color: #00c0ef; margin-bottom: 15px; }
    canvas { width: 100% !important; max-height: 350px; }

    /* Table */
    .table-wrapper { width: 100%; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; min-width: 500px; }
    table th, table td { padding: 12px; text-align: left; }
    table th { background-color: #2a2d3b; }
    table tr:nth-child(even) { background-color: #2a2d3b; }
    table tr:nth-child(odd) { background-color: #232634; }
    table tr:hover { background-color: #33364d; }
</style>
{% endblock %}

{% block content %}
<div class="sidebar">
    <a href="{% url 'admin:auth_user_changelist' %}"><i class="fas fa-user"></i> Users</a>
    <a href="{% url 'admin:myapp_preinscription_changelist' %}"><i class="fas fa-user-graduate"></i> PrÃ©inscriptions</a>
    <a href="{% url 'admin:myapp_formation_changelist' %}"><i class="fas fa-book"></i> Formations</a>
</div>

<div class="main-content">
    <!-- Stat cards -->
    <div class="cards-wrapper">
        <div class="stat-card"><i class="fas fa-user-graduate"></i>
            <div class="stat-info">
                <span class="number"><h5>{{ total_preinscrits }}</h5></span>
                <span class="label"><h5>Ã‰tudiants prÃ©inscrits</h5></span>
            </div>
        </div>
    </div>

    <!-- Dashboard row: Graphique et Tableau -->
    <div class="dashboard-row">

        <!-- Graphique par formation -->
        <div class="dashboard-col">
            <div class="chart-card">
                <h3>PrÃ©inscriptions par formation</h3>
                <canvas id="formationsChart"></canvas>
            </div>
        </div>

        <!-- Tableau -->
        <div class="dashboard-col">
            <div class="chart-card">
                <h3>ðŸ“Š PrÃ©inscriptions par formation</h3>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Formation</th>
                                <th>Nombre dâ€™Ã©tudiants</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in preinscrits_par_formation %}
                                {{ row|safe }}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const labels = [
        {% for row in preinscrits_par_formation %}
            "{{ row|safe|slice:'<tr><td>'|slice:'</td><td>' }}",
        {% endfor %}
    ];
    const dataCounts = [
        {% for row in preinscrits_par_formation %}
            {{ row|safe|slice:'<td>'|slice:'</td>' }},
        {% endfor %}
    ];

    const data = {
        labels: labels,
        datasets: [{
            label: 'Nombre dâ€™Ã©tudiants',
            data: dataCounts,
            backgroundColor: '#00c0ef'
        }]
    };

    const config = {
        type: 'bar',
        data: data,
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                y: { beginAtZero: true, ticks: { color: 'white', stepSize: 1 }, grid: { color: 'rgba(255,255,255,0.1)' } }
            }
        }
    };

    const ctx = document.getElementById('formationsChart');
    new Chart(ctx, config);
});
</script>
{% endblock %}
